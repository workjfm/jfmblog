<?php
//000000000000
 exit();?>
a:10:{i:0;a:16:{s:2:"id";i:22;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:19:"tp5 抽离验证层";s:7:"summary";s:24:"<p>tp5 验证层<br></p>";s:7:"content";s:8493:"<p>1. 新建一个公共的验证器，内容如下</p><pre><code><span style="color:#c679dd;font-style:italic;"><?php<br></span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * Created by PhpStorm.<br></span><span style="color:#59626f;font-style:italic;"> * User: 17839<br></span><span style="color:#59626f;font-style:italic;"> * Date: 2020/3/18<br></span><span style="color:#59626f;font-style:italic;"> * Time: 15:21<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#59626f;font-style:italic;"><br></span><span style="color:#c679dd;font-style:italic;">namespace </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">api</span>\<span style="color:#c3d3de;">validate</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">;<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Request</span><span style="color:#a6b2c0;">;<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Validate</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">BaseValidate </span><span style="color:#c679dd;font-style:italic;">extends </span><span style="color:#c3d3de;">Validate<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">校验参数通用方法<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">goCheck</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// 1.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取</span><span style="color:#59626f;font-style:italic;">http</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求传递的数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#59626f;font-style:italic;">// 2.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">对这些参数校验<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$request </span><span style="color:#a6b2c0;">= </span><span style="color:#e5c17c;">Request</span><span style="color:#a6b2c0;">::</span><span style="color:#61aeef;">instance</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$params </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$request</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">param</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$result </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">batch</span><span style="color:#a6b2c0;">()-></span><span style="color:#61aeef;">check</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$params</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(!</span><span style="color:#dcdfe4;">$result</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$error </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">error</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">throw new </span><span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$error</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        } </span><span style="color:#c679dd;font-style:italic;">else </span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">return true</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">}</span></code></pre><p>2.调用goCheck()</p><pre><code><span style="color:#c679dd;font-style:italic;"><?php<br></span><span style="color:#c679dd;font-style:italic;"><br></span><span style="color:#c679dd;font-style:italic;">namespace </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">api</span>\<span style="color:#c3d3de;">controller</span>\<span style="color:#c3d3de;">v1</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">api</span>\<span style="color:#c3d3de;">validate</span>\<span style="color:#c3d3de;">IDMustBePositiveInt</span><span style="color:#a6b2c0;">;<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Controller</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">Banner </span><span style="color:#c679dd;font-style:italic;">extends </span><span style="color:#c3d3de;">Controller<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取指定</span><span style="color:#59626f;font-style:italic;">id</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">的</span><span style="color:#59626f;font-style:italic;">banner</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">信息<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@url </span><span style="color:#59626f;font-style:italic;">/banner/:id<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@http </span><span style="color:#59626f;font-style:italic;">GET<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">getBanner</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$id</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        (</span><span style="color:#c679dd;font-style:italic;">new </span><span style="color:#c3d3de;">IDMustBePositiveInt</span><span style="color:#a6b2c0;">())-></span><span style="color:#61aeef;">goCheck</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;">}<br></span></code></pre>";s:5:"thumb";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:4;s:8:"comments";i:0;s:10:"createtime";i:1584517976;s:10:"updatetime";i:1584518001;s:5:"weigh";i:22;s:6:"status";s:6:"normal";}i:1;a:16:{s:2:"id";i:21;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:21:"php通用请求方法";s:7:"summary";s:32:"<p>php通用请求方法<br></p>";s:7:"content";s:9546:"<pre><code><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * api</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">通用请求方法<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';"> </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">string $url  [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求地址</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $post [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是否是</span><span style="color:#59626f;font-style:italic;">post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $https [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是否是</span><span style="color:#59626f;font-style:italic;">http</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">array $data [post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求的参数</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">mixed|string [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求返回值</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#c679dd;font-style:italic;">function </span><span style="color:#61aeef;">http_curl</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$url</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$post </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$https </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$data </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">null</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 1.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">初始化链接<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#dcdfe4;">$ch </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">curl_init</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$url</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 2.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">设置链接参数<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_RETURNTRANSFER</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取的信息以字符串返回，而不是直接输出。<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$post </span><span style="color:#a6b2c0;">== </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_POST</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">判断是不是</span><span style="color:#59626f;font-style:italic;">post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_POSTFIELDS</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">);  </span><span style="color:#59626f;font-style:italic;">//</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">设置</span><span style="color:#59626f;font-style:italic;">post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求的请求数据</span><span style="color:#59626f;font-style:italic;">data</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">为一个数组<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#a6b2c0;">}<br></span><span style="color:#a6b2c0;">    </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$https </span><span style="color:#a6b2c0;">== </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_SSL_VERIFYPEER</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">禁止验证对等的证书<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_SSL_VERIFYHOST</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">禁止验证主机证书<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#a6b2c0;">}<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 3.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">发送请求<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#dcdfe4;">$result </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">curl_exec</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 4.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">关闭链接<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#61aeef;">curl_close</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 5.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">返回数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#dcdfe4;">$result</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">}</span></code></pre>";s:5:"thumb";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:1;s:8:"comments";i:0;s:10:"createtime";i:1584501337;s:10:"updatetime";i:1584501364;s:5:"weigh";i:21;s:6:"status";s:6:"normal";}i:2;a:16:{s:2:"id";i:20;s:11:"category_id";i:5;s:4:"flag";s:0:"";s:5:"title";s:21:"composer 中国镜像";s:7:"summary";s:32:"<p>composer 中国镜像<br></p>";s:7:"content";s:104:"<pre><code>composer config -g repo.packagist composer https://packagist.phpcomposer.com<br></code></pre>";s:5:"thumb";s:54:"/uploads/20200316/e27ba4d463ba84734244c0f15c23611b.png";s:5:"image";s:54:"/uploads/20200316/e27ba4d463ba84734244c0f15c23611b.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:8;s:8:"comments";i:0;s:10:"createtime";i:1584026034;s:10:"updatetime";i:1584359714;s:5:"weigh";i:20;s:6:"status";s:6:"normal";}i:3;a:16:{s:2:"id";i:19;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:27:"thinkphp5+ajax 上传图片";s:7:"summary";s:38:"<p>thinkphp5+ajax 上传图片<br></p>";s:7:"content";s:6935:"<p>1. 前端部分</p><pre><code><!DOCTYPE html><html lang="en"><head>    <meta charset="UTF-8">    <title>Title</title></head><body><form method="post" enctype="multipart/form-data">    <div style="margin: 20px 20px 20px 10px;">        主题图片:
        <span id="img-list-box" style="margin-left: 25px;"></span>        <span style="display:inline-block;height: 30px;position: relative;top:0px;left:0px;">    <a style="display: inline-block;width: 100px;height:30px;line-height: 30px;text-align:center;background: #F60;color: #FFF;">图片上传</a>    <input type="file" name="img_src" style="width: 100px;border: 1px solid red;position: absolute;top:0px;left: 0px;height: 30px;opacity: 0;" id="up-img-file" onchange="upimg(this)">   </span>    </div></form><script type="text/javascript" src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js"></script><script type="text/javascript">    function upimg(obj)    {        if( obj.value == "" ) {            return;        }        var formdata = new FormData();        //<input type="file" name="img" value="" />        formdata.append("img" , $(obj)[0].files[0]);//获取文件法二        $.ajax({            type : 'post',            url : '/index/index/ajaxUpload', //接口            data : formdata,            cache : false,            processData : false, // 不处理发送的数据，因为data值是Formdata对象，不需要对数据做处理            contentType : false, // 不设置Content-type请求头            success : function(response){                console.log(response);                var html = '<div style="position: relative;margin-right: 20px;margin-bottom: 15px;width: 132px;display: inline-block;border: 1px solid #CCC;background:#EEE;">'                    +'<span style="display: block;width: 120px;height: 80px;border: 1px solid #F2F1F0;margin: 5px;overflow: hidden;">'                    +'<img src="'+response+'" style="width: 100%;" />'                    +'</span>'                    +'<input type="hidden" name="imgs[]" value="'+response+'" />'                    +'<a onclick="delImg(this);" style="z-index: 10;display: block;top: -8px;cursor:pointer;right: -8px;position:absolute;width: 20px;height: 20px;background: #CCC;border-radius:100%;text-align:center;line-height: 20px;border: 1px solid #C1C1C1;color: #555;">X</a>'                    +'</div>';                $('#img-list-box').append(html);            },            error : function(){ }        });    }    function delImg(obj)    {        $(obj).parent('div').remove();    }</script></body></html><br></code></pre><p>2.php</p><pre><code><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">ajaxUpload</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">//</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">验证<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#dcdfe4;">$file </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">request</span><span style="color:#a6b2c0;">()-></span><span style="color:#61aeef;">file</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'img'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">移动到框架应用根目录</span><span style="color:#59626f;font-style:italic;">/public/uploads/ </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">目录下<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">if</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$file</span><span style="color:#a6b2c0;">){<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$info </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$file</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">move</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">ROOT_PATH </span><span style="color:#a6b2c0;">. </span><span style="color:#98c379;">'public' </span><span style="color:#a6b2c0;">. </span><span style="color:#d19a66;">DS </span><span style="color:#a6b2c0;">. </span><span style="color:#98c379;">'uploads'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$info</span><span style="color:#a6b2c0;">){<br></span><span style="color:#a6b2c0;">            </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">成功上传后 获取上传信息<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">            </span><span style="color:#dcdfe4;">$img_src </span><span style="color:#a6b2c0;">= </span><span style="color:#98c379;">'/uploads/'</span><span style="color:#a6b2c0;">.</span><span style="color:#dcdfe4;">$info</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">getSaveName</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#dcdfe4;">$img_src</span><span style="color:#a6b2c0;">; </span><span style="color:#59626f;font-style:italic;">//</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">返回</span><span style="color:#59626f;font-style:italic;">ajax</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#a6b2c0;">}</span><span style="color:#c679dd;font-style:italic;">else</span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">            </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">上传失败获取错误信息<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">            </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">error</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$file</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">getError</span><span style="color:#a6b2c0;">());<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;">}</span></code></pre>";s:5:"thumb";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:8;s:8:"comments";i:0;s:10:"createtime";i:1584003781;s:10:"updatetime";i:1584360032;s:5:"weigh";i:19;s:6:"status";s:6:"normal";}i:4;a:16:{s:2:"id";i:18;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:29:"thinkphp使用七牛云存储";s:7:"summary";s:40:"<p>thinkphp使用七牛云存储<br></p>";s:7:"content";s:14806:"<p>1.使用composer下载sdk</p><pre><code>composer require qiniu/php-sdk</code></pre><p>2.新建上传类库<img alt="1583996859(1).jpg" src="/uploads/20200312/2bb774ab1c67863f2f1e7f5d451bb58b.jpg" width="460" height="147"></p><p>3.上传类库</p><pre><code><span style="color:#c679dd;font-style:italic;"><?php<br></span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * Created by PhpStorm.<br></span><span style="color:#59626f;font-style:italic;"> * User: 17839<br></span><span style="color:#59626f;font-style:italic;"> * Date: 2020/3/12<br></span><span style="color:#59626f;font-style:italic;"> * Time: 13:53<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#59626f;font-style:italic;"><br></span><span style="color:#c679dd;font-style:italic;">namespace </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">common</span>\<span style="color:#c3d3de;">lib</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">引入鉴权类<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">Qiniu</span>\<span style="color:#c3d3de;">Auth</span><span style="color:#a6b2c0;">;<br></span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">引入上传类<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">Qiniu</span>\<span style="color:#c3d3de;">Storage</span>\<span style="color:#c3d3de;">UploadManager</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">七牛图片上传基础类库<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';"> </span><span style="color:#59626f;font-style:italic;">* Class Upload<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@package </span><span style="color:#59626f;font-style:italic;">app\common\lib<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">Upload<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">图片上传<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">*/<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public static function </span><span style="color:#61aeef;">image</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#59626f;font-style:italic;">//        halt($_FILES['file']);<br></span><span style="color:#59626f;font-style:italic;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#c679dd;font-style:italic;">empty</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$_FILES</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'file'</span><span style="color:#a6b2c0;">][</span><span style="color:#98c379;">'tmp_name'</span><span style="color:#a6b2c0;">])) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#61aeef;">exception</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">您提交的图片不合法</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">要上传的文件<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$file </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$_FILES</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'file'</span><span style="color:#a6b2c0;">][</span><span style="color:#98c379;">'tmp_name'</span><span style="color:#a6b2c0;">];<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">文件的后缀<br></span><span style="color:#59626f;font-style:italic;">//        $ext  = explode('.', $_FILES['file']['name'])[1];<br></span><span style="color:#59626f;font-style:italic;">        </span><span style="color:#dcdfe4;">$pathinfo </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">pathinfo</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$_FILES</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'file'</span><span style="color:#a6b2c0;">][</span><span style="color:#98c379;">'name'</span><span style="color:#a6b2c0;">]);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$ext </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$pathinfo</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'extension'</span><span style="color:#a6b2c0;">];<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$config </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">config</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'qiniu'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">构建一个鉴权对象<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$auth </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">new </span><span style="color:#c3d3de;">Auth</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$config</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'ak'</span><span style="color:#a6b2c0;">], </span><span style="color:#dcdfe4;">$config</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'sk'</span><span style="color:#a6b2c0;">]);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">//</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">生成上传的</span><span style="color:#59626f;font-style:italic;">token<br></span><span style="color:#59626f;font-style:italic;">        </span><span style="color:#dcdfe4;">$token </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$auth</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">uploadToken</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$config</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'bucket'</span><span style="color:#a6b2c0;">]);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">上传到七牛后保存的文件名<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$key </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">date</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'Y'</span><span style="color:#a6b2c0;">) . </span><span style="color:#98c379;">'/' </span><span style="color:#a6b2c0;">. </span><span style="color:#61aeef;">date</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'m'</span><span style="color:#a6b2c0;">) . </span><span style="color:#98c379;">'/' </span><span style="color:#a6b2c0;">. </span><span style="color:#61aeef;">substr</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">md5</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$file</span><span style="color:#a6b2c0;">),<br></span><span style="color:#a6b2c0;">                </span><span style="color:#d19a66;">0</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">5</span><span style="color:#a6b2c0;">) . </span><span style="color:#61aeef;">date</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'YmdHis'</span><span style="color:#a6b2c0;">) . </span><span style="color:#61aeef;">rand</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">0</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">9999</span><span style="color:#a6b2c0;">) . </span><span style="color:#98c379;">'.' </span><span style="color:#a6b2c0;">. </span><span style="color:#dcdfe4;">$ext</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">初始化</span><span style="color:#59626f;font-style:italic;">UploadManager</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">类<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$uploadMgr </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">new </span><span style="color:#c3d3de;">UploadManager</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">list</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ret</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$err</span><span style="color:#a6b2c0;">)       = </span><span style="color:#dcdfe4;">$uploadMgr</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">putFile</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$token</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$key</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$file</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$err </span><span style="color:#a6b2c0;">!== </span><span style="color:#c679dd;font-style:italic;">null</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">return null</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        } </span><span style="color:#c679dd;font-style:italic;">else </span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#dcdfe4;">$key</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;">}</span></code></pre><p>4.上传类库中需要的配置文件</p><p><img alt="1583996978(1).jpg" src="/uploads/20200312/cb400c9a6f762980d02b75d15a3c174b.jpg" width="453" height="166"><br></p><p>5.配置文件内容</p><pre><code><span style="color:#c679dd;font-style:italic;"><?php<br></span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * Created by PhpStorm.<br></span><span style="color:#59626f;font-style:italic;"> * User: 17839<br></span><span style="color:#59626f;font-style:italic;"> * Date: 2020/3/12<br></span><span style="color:#59626f;font-style:italic;"> * Time: 12:54<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#59626f;font-style:italic;"><br></span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#a6b2c0;">[<br></span><span style="color:#a6b2c0;">    </span><span style="color:#98c379;">'ak' </span><span style="color:#a6b2c0;">=> </span><span style="color:#98c379;">'xxx'</span><span style="color:#a6b2c0;">, </span><span style="color:#59626f;font-style:italic;">// AccessKey<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#98c379;">'sk' </span><span style="color:#a6b2c0;">=> </span><span style="color:#98c379;">'xxx'</span><span style="color:#a6b2c0;">, </span><span style="color:#59626f;font-style:italic;">// SecretKey<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#98c379;">'bucket' </span><span style="color:#a6b2c0;">=> </span><span style="color:#98c379;">'xxx'</span><span style="color:#a6b2c0;">, </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">空间名称<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#98c379;">'image_url' </span><span style="color:#a6b2c0;">=> </span><span style="color:#98c379;">'xxx'   </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">测试域名<br></span><span style="color:#a6b2c0;">];</span></code></pre><p>6.使用上传类库</p><pre><code><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">upload</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#dcdfe4;">$image </span><span style="color:#a6b2c0;">= </span><span style="color:#e5c17c;">Upload</span><span style="color:#a6b2c0;">::</span><span style="color:#61aeef;">image</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">}</span></code></pre>";s:5:"thumb";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:9;s:8:"comments";i:0;s:10:"createtime";i:1583997278;s:10:"updatetime";i:1584360115;s:5:"weigh";i:18;s:6:"status";s:6:"normal";}i:5;a:16:{s:2:"id";i:17;s:11:"category_id";i:9;s:4:"flag";s:0:"";s:5:"title";s:13:"http状态码";s:7:"summary";s:24:"<p>http状态码<br></p>";s:7:"content";s:335:"<pre><code>200    请求成功                    201    创建成功
202    更新成功

400    无效请求                    401    未授权
403    禁止访问                    404    请求资源不存在

500    服务器内部错误</code></pre>";s:5:"thumb";s:54:"/uploads/20200312/e248cbdbbf6919fc6261d2d3adc8ed9a.jpg";s:5:"image";s:54:"/uploads/20200312/e248cbdbbf6919fc6261d2d3adc8ed9a.jpg";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:6;s:8:"comments";i:0;s:10:"createtime";i:1583931829;s:10:"updatetime";i:1584025397;s:5:"weigh";i:17;s:6:"status";s:6:"normal";}i:6;a:16:{s:2:"id";i:16;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:15:"rsa加密解密";s:7:"summary";s:26:"<p>rsa加密解密<br></p>";s:7:"content";s:26510:"<pre><code><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">RsaService<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">公钥<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@var<br></span><span style="color:#c679dd;font-weight:bold;font-style:italic;">     </span><span style="color:#59626f;font-style:italic;">*/<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">protected </span><span style="color:#e06c75;">$public_key</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">私钥<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@var<br></span><span style="color:#c679dd;font-weight:bold;font-style:italic;">     </span><span style="color:#59626f;font-style:italic;">*/<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">protected </span><span style="color:#e06c75;">$private_key</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">公钥文件路径<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@var<br></span><span style="color:#c679dd;font-weight:bold;font-style:italic;">     </span><span style="color:#59626f;font-style:italic;">*/<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">protected </span><span style="color:#e06c75;">$public_key_path </span><span style="color:#a6b2c0;">= </span><span style="color:#98c379;">'keys/rsa_public_key.pub'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">采用</span><span style="color:#59626f;font-style:italic;">pkcs8</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">只是为了方便程序解析<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">私钥文件路径<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@var<br></span><span style="color:#c679dd;font-weight:bold;font-style:italic;">     </span><span style="color:#59626f;font-style:italic;">*/<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">protected </span><span style="color:#e06c75;">$private_key_path </span><span style="color:#a6b2c0;">= </span><span style="color:#98c379;">'keys/rsa_private_key_pkcs8.pem'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">初始化配置<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* RsaService constructor.<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $type </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">默认私钥加密<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">*/<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">__construct</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$type </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$type</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">private_key </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">getPrivateKey</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        } </span><span style="color:#c679dd;font-style:italic;">else </span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">public_key </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">getPublicKey</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">配置私钥<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* openssl_pkey_get_private</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">这个函数可用来判断私钥是否是可用的，可用，返回资源<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">bool|resource<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">getPrivateKey</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$original_private_key </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">file_get_contents</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">__DIR__ </span><span style="color:#a6b2c0;">. </span><span style="color:#98c379;">'/../' </span><span style="color:#a6b2c0;">. </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">private_key_path</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">openssl_pkey_get_private</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$original_private_key</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">配置公钥<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* openssl_pkey_get_public</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">这个函数可用来判断私钥是否是可用的，可用，返回资源<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">resource<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">getPublicKey</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$original_public_key </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">file_get_contents</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">__DIR__ </span><span style="color:#a6b2c0;">. </span><span style="color:#98c379;">'/../' </span><span style="color:#a6b2c0;">. </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">public_key_path</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">openssl_pkey_get_public</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$original_public_key</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">私钥加密<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$data<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $serialize </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是为了不管你传的是字符串还是数组，都能转成字符串<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">privateEncrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$serialize </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">openssl_private_encrypt</span><span style="color:#a6b2c0;">(<br></span><span style="color:#a6b2c0;">            </span><span style="color:#d19a66;">$serialize </span><span style="color:#a6b2c0;">? </span><span style="color:#61aeef;">serialize</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">) : </span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">,<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$encrypted</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">private_key<br></span><span style="color:#e06c75;">        </span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$encrypted </span><span style="color:#a6b2c0;">=== </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">throw new </span>\<span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'Could not encrypt the data.'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">base64_encode</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$encrypted</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">私钥解密<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$data<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $unserialize<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">mixed<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">privateDecrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$unserialize </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">openssl_private_decrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">base64_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">),</span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">private_key</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$decrypted </span><span style="color:#a6b2c0;">=== </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">throw new </span>\<span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'Could not decrypt the data.'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#d19a66;">$unserialize </span><span style="color:#a6b2c0;">? </span><span style="color:#61aeef;">unserialize</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">) : </span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">公钥加密<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$data<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $serialize </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是为了不管你传的是字符串还是数组，都能转成字符串<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">publicEncrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$serialize </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">openssl_public_encrypt</span><span style="color:#a6b2c0;">(<br></span><span style="color:#a6b2c0;">            </span><span style="color:#d19a66;">$serialize </span><span style="color:#a6b2c0;">? </span><span style="color:#61aeef;">serialize</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">) : </span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">,<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$encrypted</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">public_key<br></span><span style="color:#e06c75;">        </span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$encrypted </span><span style="color:#a6b2c0;">=== </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">throw new </span>\<span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'Could not encrypt the data.'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">base64_encode</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$encrypted</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">公钥解密<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$data<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $unserialize<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">mixed<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">publicDecrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$unserialize </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">openssl_public_decrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">base64_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">),</span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">public_key</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$decrypted </span><span style="color:#a6b2c0;">=== </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">throw new </span>\<span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'Could not decrypt the data.'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#d19a66;">$unserialize </span><span style="color:#a6b2c0;">? </span><span style="color:#61aeef;">unserialize</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">) : </span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;">}</span></code></pre>";s:5:"thumb";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:2;s:8:"comments";i:0;s:10:"createtime";i:1583912922;s:10:"updatetime";i:1584359824;s:5:"weigh";i:16;s:6:"status";s:6:"normal";}i:7;a:16:{s:2:"id";i:15;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:15:"aes加密解密";s:7:"summary";s:26:"<p>aes加密解密<br></p>";s:7:"content";s:42443:"<pre><code><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">Encryption<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">加密密钥<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@var </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private </span><span style="color:#e06c75;">$key</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">加密算法<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@var </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private </span><span style="color:#e06c75;">$cipher</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">初始化加密密钥和加密方式<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* Encryption constructor.<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$key<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">string $cipher<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">__construct</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$key</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$cipher </span><span style="color:#a6b2c0;">= </span><span style="color:#98c379;">'AES-128-CBC'</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#d19a66;">$key </span><span style="color:#a6b2c0;">= (string) </span><span style="color:#61aeef;">base64_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$key</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">verifyRule</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$key</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$cipher</span><span style="color:#a6b2c0;">)) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">key </span><span style="color:#a6b2c0;">= </span><span style="color:#d19a66;">$key</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">cipher </span><span style="color:#a6b2c0;">= </span><span style="color:#d19a66;">$cipher</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        } </span><span style="color:#c679dd;font-style:italic;">else </span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">密钥格式错误</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">exit</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">判断加密方式和传的</span><span style="color:#59626f;font-style:italic;">key</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">的长度是否相同<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$key<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$cipher<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">bool<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">verifyRule</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$key</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$cipher</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">按照</span><span style="color:#59626f;font-style:italic;">8bit</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">位的方式计算字符长度<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$length </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">mb_strlen</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$key</span><span style="color:#a6b2c0;">, </span><span style="color:#98c379;">'8bit'</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">//</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">编码格式为</span><span style="color:#59626f;font-style:italic;">AES128</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">的要求字符长度为</span><span style="color:#59626f;font-style:italic;">16</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">。编码格式为</span><span style="color:#59626f;font-style:italic;">AES256</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">的要求字符长度为</span><span style="color:#59626f;font-style:italic;">32</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">位<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$cipher </span><span style="color:#a6b2c0;">=== </span><span style="color:#98c379;">'AES-128-CBC' </span><span style="color:#a6b2c0;">&& </span><span style="color:#dcdfe4;">$length </span><span style="color:#a6b2c0;">=== </span><span style="color:#d19a66;">16</span><span style="color:#a6b2c0;">) ||<br></span><span style="color:#a6b2c0;">            (</span><span style="color:#d19a66;">$cipher </span><span style="color:#a6b2c0;">=== </span><span style="color:#98c379;">'AES-256-CBC' </span><span style="color:#a6b2c0;">&& </span><span style="color:#dcdfe4;">$length </span><span style="color:#a6b2c0;">=== </span><span style="color:#d19a66;">32</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">生成密钥<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$cipher </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">加密方式<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public static function </span><span style="color:#61aeef;">generateKey</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$cipher</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// random_bytes</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">生成一个加密安全的随机字节<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">base64_encode</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">random_bytes</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$cipher </span><span style="color:#a6b2c0;">=== </span><span style="color:#98c379;">'AES-128-CBC' </span><span style="color:#a6b2c0;">? </span><span style="color:#d19a66;">16 </span><span style="color:#a6b2c0;">: </span><span style="color:#d19a66;">32</span><span style="color:#a6b2c0;">));<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">加密数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$value<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $serialize </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是为了不管你传的是字符串还是数组，都能转成字符串<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">encrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$serialize </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// openssl_cipher_iv_length</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取密码</span><span style="color:#59626f;font-style:italic;">IV</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">长度，</span><span style="color:#59626f;font-style:italic;">$iv</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">加解密的向量，有些方法需要设置比如</span><span style="color:#59626f;font-style:italic;">CBC<br></span><span style="color:#59626f;font-style:italic;">        </span><span style="color:#dcdfe4;">$iv </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">random_bytes</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">openssl_cipher_iv_length</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">cipher</span><span style="color:#a6b2c0;">));<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">使用</span><span style="color:#59626f;font-style:italic;">openssl_encrypt</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">加密数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#d19a66;">$value </span><span style="color:#a6b2c0;">= </span>\<span style="color:#61aeef;">openssl_encrypt</span><span style="color:#a6b2c0;">(<br></span><span style="color:#a6b2c0;">            </span><span style="color:#d19a66;">$serialize </span><span style="color:#a6b2c0;">? </span><span style="color:#61aeef;">serialize</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">) : </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">,<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">cipher</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">key</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">0</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$iv<br></span><span style="color:#dcdfe4;">        </span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value </span><span style="color:#a6b2c0;">=== </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">该数据无法加密</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">exit</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">生成签名，保证内容参数没有被更改<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$sign </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">hash</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$iv </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">base64_encode</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$iv</span><span style="color:#a6b2c0;">), </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">将</span><span style="color:#59626f;font-style:italic;">IV</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">，</span><span style="color:#59626f;font-style:italic;">value,sign</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">，生成数组并生成</span><span style="color:#59626f;font-style:italic;">json</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$json </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">json_encode</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">compact</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'iv'</span><span style="color:#a6b2c0;">, </span><span style="color:#98c379;">'value'</span><span style="color:#a6b2c0;">, </span><span style="color:#98c379;">'sign'</span><span style="color:#a6b2c0;">));<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">json_last_error</span><span style="color:#a6b2c0;">() !== </span><span style="color:#d19a66;">JSON_ERROR_NONE</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">生成</span><span style="color:#98c379;">json</span><span style="color:#98c379;font-family:'宋体';">数据失败</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">exit</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">base64_encode</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$json</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">解密数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$value<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $unserialize<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">bool|mixed|string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">decrypt</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$unserialize </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#d19a66;">$value </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">getJsonValue</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$iv </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">base64_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'iv'</span><span style="color:#a6b2c0;">]);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">解密<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$decrypted </span><span style="color:#a6b2c0;">= </span>\<span style="color:#61aeef;">openssl_decrypt</span><span style="color:#a6b2c0;">(<br></span><span style="color:#a6b2c0;">            </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'value'</span><span style="color:#a6b2c0;">], </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">cipher</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">key</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">0</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$iv<br></span><span style="color:#dcdfe4;">        </span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$decrypted </span><span style="color:#a6b2c0;">=== </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">无法解密该数据</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">exit</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#d19a66;">$unserialize </span><span style="color:#a6b2c0;">? </span><span style="color:#61aeef;">unserialize</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">) : </span><span style="color:#dcdfe4;">$decrypted</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">使用</span><span style="color:#59626f;font-style:italic;">hash_hmac</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">生成</span><span style="color:#59626f;font-style:italic;">sha256</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">的加密值，用来验证参数是否更改。<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$iv<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$value<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">hash</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$iv</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">使用</span><span style="color:#59626f;font-style:italic;">hash_hmac</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">生成带有密钥的哈希值<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">hash_hmac</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'sha256'</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$iv</span><span style="color:#a6b2c0;">.</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">key</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取</span><span style="color:#59626f;font-style:italic;">json</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">数据并验证完整性和数据真实性<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$value<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">mixed<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">getJsonValue</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">还原成数组<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#d19a66;">$value </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">json_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">base64_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">), </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(! </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">validValue</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">)) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">数据不完整</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">exit</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(! </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">validSign</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">)) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">echo </span><span style="color:#98c379;">'</span><span style="color:#98c379;font-family:'宋体';">签名无效</span><span style="color:#98c379;">'</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">exit</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">验证数据完整性<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$payload<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">bool<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">validValue</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">is_array</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">) && </span><span style="color:#c679dd;font-style:italic;">isset</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'iv'</span><span style="color:#a6b2c0;">], </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'value'</span><span style="color:#a6b2c0;">], </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'sign'</span><span style="color:#a6b2c0;">]) &&<br></span><span style="color:#a6b2c0;">            </span><span style="color:#61aeef;">strlen</span><span style="color:#a6b2c0;">(</span><span style="color:#61aeef;">base64_decode</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'iv'</span><span style="color:#a6b2c0;">], </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">)) === </span><span style="color:#61aeef;">openssl_cipher_iv_length</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">cipher</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">验证签名<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">array $value<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">bool<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@throws </span><span style="color:#59626f;font-style:italic;">\Exception<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">validSign</span><span style="color:#a6b2c0;">(</span><span style="color:#c679dd;font-style:italic;">array </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$calculated </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">calculateSign</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$bytes </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">random_bytes</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">16</span><span style="color:#a6b2c0;">));<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">比较</span><span style="color:#59626f;font-style:italic;">2</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">个签名是否相等<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">hash_equals</span><span style="color:#a6b2c0;">(<br></span><span style="color:#a6b2c0;">            </span><span style="color:#61aeef;">hash_hmac</span><span style="color:#a6b2c0;">(</span><span style="color:#98c379;">'sha256'</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'sign'</span><span style="color:#a6b2c0;">], </span><span style="color:#dcdfe4;">$bytes</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">), </span><span style="color:#dcdfe4;">$calculated<br></span><span style="color:#dcdfe4;">        </span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * sha256 hash</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">值是不可逆的<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">拿随机字符串和值生成签名<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$value<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">$bytes<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">private function </span><span style="color:#61aeef;">calculateSign</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$bytes</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#61aeef;">hash_hmac</span><span style="color:#a6b2c0;">(<br></span><span style="color:#a6b2c0;">            </span><span style="color:#98c379;">'sha256'</span><span style="color:#a6b2c0;">, </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">hash</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'iv'</span><span style="color:#a6b2c0;">], </span><span style="color:#d19a66;">$value</span><span style="color:#a6b2c0;">[</span><span style="color:#98c379;">'value'</span><span style="color:#a6b2c0;">]), </span><span style="color:#d19a66;">$bytes</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">true<br></span><span style="color:#c679dd;font-style:italic;">        </span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;">}</span></code></pre>";s:5:"thumb";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:2;s:8:"comments";i:0;s:10:"createtime";i:1583912820;s:10:"updatetime";i:1584359857;s:5:"weigh";i:15;s:6:"status";s:6:"normal";}i:8;a:16:{s:2:"id";i:14;s:11:"category_id";i:2;s:4:"flag";s:9:"recommend";s:5:"title";s:33:"thinkphp api自定义异常处理";s:7:"summary";s:44:"<p>thinkphp api自定义异常处理<br></p>";s:7:"content";s:1032:"<p>1.新建一个异常处理类</p><p><img alt="1583853385(1).jpg" src="/uploads/20200310/be900dc4898c2a6a31f1e3079d17b8f3.jpg" width="401" height="227"><br></p><p>2.重写think\exception\Handle的render方法</p><p><img alt="1583855432(1).jpg" src="/uploads/20200310/ba5f14f69e3d053e5de47efa6e66e307.jpg" width="1069" height="811"><br></p><p>3.修改配置文件</p><p><img alt="1583853569(1).jpg" src="/uploads/20200310/dd7c124af8eea06c01c0484c32e5f867.jpg" width="1071" height="425"><br></p><p>4.新建代码错误异常类</p><p><img alt="1583854763(1).jpg" src="/uploads/20200310/b5bc83c989c3eec7808fc5d4fd1f0da5.jpg" width="450" height="261"><br></p><p>5.修改代码错误异常类的http状态码</p><p><img alt="1583854859(1).jpg" src="/uploads/20200310/725576a103fa400a357de302f48ccc03.jpg" width="988" height="262"><br></p><p>6.如果开启调试模式，应该报出tp框架自带的异常</p><p><img alt="1583854996(1).jpg" src="/uploads/20200310/8893d77b6b32bdc0ee157e9452eb407f.jpg" width="966" height="370"><br></p>";s:5:"thumb";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200316/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:11;s:8:"comments";i:0;s:10:"createtime";i:1583853589;s:10:"updatetime";i:1584359874;s:5:"weigh";i:14;s:6:"status";s:6:"normal";}i:9;a:16:{s:2:"id";i:13;s:11:"category_id";i:7;s:4:"flag";s:0:"";s:5:"title";s:23:"mysql远程连接设置";s:7:"summary";s:34:"<p>mysql远程连接设置<br></p>";s:7:"content";s:559:"<p>1.登陆mysql</p><pre><code>msyql -uroot -p</code></pre><p>2,授权</p><pre><code>GRANT ALL PRIVILEGES ON *.* TO '用户名'@'%' IDENTIFIED BY '密码' WITH GRANT OPTION;<br></code></pre><p>3.刷新权限</p><pre><code>flush privileges</code></pre><p>4.查看权限</p><pre><code>select user,host from mysql.user;<br></code></pre><p>5.修改配置文件</p><pre><code>/etc/mysql/mysql.conf.d/mysqld.cnf

将bind-address = 127.0.0.1修改为bind-address = 0.0.0.0<br></code></pre><p>6.重启mysql</p><pre><code>sudo service mysql restart;<br></code></pre>";s:5:"thumb";s:54:"/uploads/20200312/be7330a8db91b3cbdab048833b50690a.jpg";s:5:"image";s:54:"/uploads/20200312/be7330a8db91b3cbdab048833b50690a.jpg";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:6;s:8:"comments";i:0;s:10:"createtime";i:1583748196;s:10:"updatetime";i:1584769803;s:5:"weigh";i:13;s:6:"status";s:6:"normal";}}