<?php
//000000000000
 exit();?>
a:3:{i:0;a:16:{s:2:"id";i:22;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:19:"tp5 抽离验证层";s:7:"summary";s:24:"<p>tp5 验证层<br></p>";s:7:"content";s:8493:"<p>1. 新建一个公共的验证器，内容如下</p><pre><code><span style="color:#c679dd;font-style:italic;"><?php<br></span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * Created by PhpStorm.<br></span><span style="color:#59626f;font-style:italic;"> * User: 17839<br></span><span style="color:#59626f;font-style:italic;"> * Date: 2020/3/18<br></span><span style="color:#59626f;font-style:italic;"> * Time: 15:21<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#59626f;font-style:italic;"><br></span><span style="color:#c679dd;font-style:italic;">namespace </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">api</span>\<span style="color:#c3d3de;">validate</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">;<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Request</span><span style="color:#a6b2c0;">;<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Validate</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">BaseValidate </span><span style="color:#c679dd;font-style:italic;">extends </span><span style="color:#c3d3de;">Validate<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">校验参数通用方法<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">goCheck</span><span style="color:#a6b2c0;">()<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#59626f;font-style:italic;">// 1.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取</span><span style="color:#59626f;font-style:italic;">http</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求传递的数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#59626f;font-style:italic;">// 2.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">对这些参数校验<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#dcdfe4;">$request </span><span style="color:#a6b2c0;">= </span><span style="color:#e5c17c;">Request</span><span style="color:#a6b2c0;">::</span><span style="color:#61aeef;">instance</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$params </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$request</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">param</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;">        </span><span style="color:#dcdfe4;">$result </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#61aeef;">batch</span><span style="color:#a6b2c0;">()-></span><span style="color:#61aeef;">check</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$params</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(!</span><span style="color:#dcdfe4;">$result</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">            </span><span style="color:#dcdfe4;">$error </span><span style="color:#a6b2c0;">= </span><span style="color:#dcdfe4;">$this</span><span style="color:#a6b2c0;">-></span><span style="color:#e06c75;">error</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">throw new </span><span style="color:#c3d3de;">Exception</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$error</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">        } </span><span style="color:#c679dd;font-style:italic;">else </span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">            </span><span style="color:#c679dd;font-style:italic;">return true</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">        }<br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">}</span></code></pre><p>2.调用goCheck()</p><pre><code><span style="color:#c679dd;font-style:italic;"><?php<br></span><span style="color:#c679dd;font-style:italic;"><br></span><span style="color:#c679dd;font-style:italic;">namespace </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">api</span>\<span style="color:#c3d3de;">controller</span>\<span style="color:#c3d3de;">v1</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">app</span>\<span style="color:#c3d3de;">api</span>\<span style="color:#c3d3de;">validate</span>\<span style="color:#c3d3de;">IDMustBePositiveInt</span><span style="color:#a6b2c0;">;<br></span><span style="color:#c679dd;font-style:italic;">use </span><span style="color:#c3d3de;">think</span>\<span style="color:#c3d3de;">Controller</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#c679dd;font-style:italic;">class </span><span style="color:#e5c17c;">Banner </span><span style="color:#c679dd;font-style:italic;">extends </span><span style="color:#c3d3de;">Controller<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取指定</span><span style="color:#59626f;font-style:italic;">id</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">的</span><span style="color:#59626f;font-style:italic;">banner</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">信息<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">     </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@url </span><span style="color:#59626f;font-style:italic;">/banner/:id<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@http </span><span style="color:#59626f;font-style:italic;">GET<br></span><span style="color:#59626f;font-style:italic;">     * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">string<br></span><span style="color:#59626f;font-style:italic;">     */<br></span><span style="color:#59626f;font-style:italic;">    </span><span style="color:#c679dd;font-style:italic;">public function </span><span style="color:#61aeef;">getBanner</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$id</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">    {<br></span><span style="color:#a6b2c0;">        (</span><span style="color:#c679dd;font-style:italic;">new </span><span style="color:#c3d3de;">IDMustBePositiveInt</span><span style="color:#a6b2c0;">())-></span><span style="color:#61aeef;">goCheck</span><span style="color:#a6b2c0;">();<br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;"><br></span><span style="color:#a6b2c0;">    }<br></span><span style="color:#a6b2c0;">}<br></span></code></pre>";s:5:"thumb";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:4;s:8:"comments";i:0;s:10:"createtime";i:1584517976;s:10:"updatetime";i:1584518001;s:5:"weigh";i:22;s:6:"status";s:6:"normal";}i:1;a:16:{s:2:"id";i:21;s:11:"category_id";i:2;s:4:"flag";s:0:"";s:5:"title";s:21:"php通用请求方法";s:7:"summary";s:32:"<p>php通用请求方法<br></p>";s:7:"content";s:9546:"<pre><code><span style="color:#59626f;font-style:italic;">/**<br></span><span style="color:#59626f;font-style:italic;"> * api</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">通用请求方法<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';"> </span><span style="color:#59626f;font-style:italic;">* </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">string $url  [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求地址</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $post [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是否是</span><span style="color:#59626f;font-style:italic;">post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">bool $https [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">是否是</span><span style="color:#59626f;font-style:italic;">http</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@param </span><span style="color:#59626f;font-style:italic;">array $data [post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求的参数</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> * </span><span style="color:#c679dd;font-weight:bold;font-style:italic;">@return </span><span style="color:#59626f;font-style:italic;">mixed|string [</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求返回值</span><span style="color:#59626f;font-style:italic;">]<br></span><span style="color:#59626f;font-style:italic;"> */<br></span><span style="color:#c679dd;font-style:italic;">function </span><span style="color:#61aeef;">http_curl</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$url</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$post </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$https </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$data </span><span style="color:#a6b2c0;">= </span><span style="color:#c679dd;font-style:italic;">null</span><span style="color:#a6b2c0;">)<br></span><span style="color:#a6b2c0;">{<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 1.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">初始化链接<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#dcdfe4;">$ch </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">curl_init</span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$url</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 2.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">设置链接参数<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_RETURNTRANSFER</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">获取的信息以字符串返回，而不是直接输出。<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$post </span><span style="color:#a6b2c0;">== </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_POST</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">判断是不是</span><span style="color:#59626f;font-style:italic;">post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_POSTFIELDS</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">$data</span><span style="color:#a6b2c0;">);  </span><span style="color:#59626f;font-style:italic;">//</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">设置</span><span style="color:#59626f;font-style:italic;">post</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">请求的请求数据</span><span style="color:#59626f;font-style:italic;">data</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">为一个数组<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#a6b2c0;">}<br></span><span style="color:#a6b2c0;">    </span><span style="color:#c679dd;font-style:italic;">if </span><span style="color:#a6b2c0;">(</span><span style="color:#d19a66;">$https </span><span style="color:#a6b2c0;">== </span><span style="color:#c679dd;font-style:italic;">true</span><span style="color:#a6b2c0;">) {<br></span><span style="color:#a6b2c0;">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_SSL_VERIFYPEER</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">禁止验证对等的证书<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">        </span><span style="color:#61aeef;">curl_setopt</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">, </span><span style="color:#d19a66;">CURLOPT_SSL_VERIFYHOST</span><span style="color:#a6b2c0;">, </span><span style="color:#c679dd;font-style:italic;">false</span><span style="color:#a6b2c0;">); </span><span style="color:#59626f;font-style:italic;">// </span><span style="color:#59626f;font-style:italic;font-family:'宋体';">禁止验证主机证书<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#a6b2c0;">}<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 3.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">发送请求<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#dcdfe4;">$result </span><span style="color:#a6b2c0;">= </span><span style="color:#61aeef;">curl_exec</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 4.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">关闭链接<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#61aeef;">curl_close</span><span style="color:#a6b2c0;">(</span><span style="color:#dcdfe4;">$ch</span><span style="color:#a6b2c0;">);<br></span><span style="color:#a6b2c0;">    </span><span style="color:#59626f;font-style:italic;">// 5.</span><span style="color:#59626f;font-style:italic;font-family:'宋体';">返回数据<br></span><span style="color:#59626f;font-style:italic;font-family:'宋体';">    </span><span style="color:#c679dd;font-style:italic;">return </span><span style="color:#dcdfe4;">$result</span><span style="color:#a6b2c0;">;<br></span><span style="color:#a6b2c0;">}</span></code></pre>";s:5:"thumb";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:5:"image";s:54:"/uploads/20200318/2ddc7ac877e7eb149f1424a1f40d5a47.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:1;s:8:"comments";i:0;s:10:"createtime";i:1584501337;s:10:"updatetime";i:1584501364;s:5:"weigh";i:21;s:6:"status";s:6:"normal";}i:2;a:16:{s:2:"id";i:20;s:11:"category_id";i:5;s:4:"flag";s:0:"";s:5:"title";s:21:"composer 中国镜像";s:7:"summary";s:32:"<p>composer 中国镜像<br></p>";s:7:"content";s:104:"<pre><code>composer config -g repo.packagist composer https://packagist.phpcomposer.com<br></code></pre>";s:5:"thumb";s:54:"/uploads/20200316/e27ba4d463ba84734244c0f15c23611b.png";s:5:"image";s:54:"/uploads/20200316/e27ba4d463ba84734244c0f15c23611b.png";s:8:"keywords";s:0:"";s:11:"description";s:0:"";s:5:"views";i:8;s:8:"comments";i:0;s:10:"createtime";i:1584026034;s:10:"updatetime";i:1584359714;s:5:"weigh";i:20;s:6:"status";s:6:"normal";}}